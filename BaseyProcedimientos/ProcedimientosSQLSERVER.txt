************************MENSAJES*************************************

CREATE OR ALTER PROC insertarMensaje
@correo varchar(45),
@asunto varchar(45),
@mensaje varchar(200)
as
INSERT INTO MensajeContacto(correo,asunto,mensaje) values(@correo,@asunto,@mensaje)
go


**********************FIN MENSAJES

********************* NOTICIAS***************************************
Create  or ALTER PROC listaNoticiasPublicas
as
SELECT idNoticia,idtipo,titulo,descripcion,imagen,fechaYHora from Noticia where idTipo=1 Order by idNoticia Desc
go

----

Create  or ALTER PROC listaNoticiasInternas
as
SELECT idNoticia,idtipo,titulo,descripcion,imagen,fechaYHora from Noticia where idTipo=2 Order by idNoticia Desc
go


---

Create or ALTER PROC ultimasNoticias
as
SELECT TOP 3 idNoticia,idtipo,titulo,descripcion,imagen,fechaYHora from Noticia where idTipo=1
ORDER BY idNoticia DESC
go

---

Create or alter proc detalleNoticia
@idNoticia int
as
SELECT n.idNoticia,p.Nombre,p.Apellido1,
n.Titulo,n.Descripcion,n.Contenido,n.Imagen,n.fechaYHora from Noticia n join  Persona p on p.idPersona=n.idUsuario  where n.idNoticia=@idNoticia
go

---

CREATE PROC crearNoticia
@idAdmin int,
@idTipo int,
@titulo varchar(100),
@descripcion varchar(300),
@contenido varchar(1000),
@imagen varchar(45),
@fechaHora datetime
as
INSERT INTO Noticia values(@idAdmin,@idTipo,@titulo,@descripcion,@contenido,@imagen,@fechaHora)
go

---

CREATE PROC insertarImagenes
@imagenes varchar(50)
as
INSERT INTO ImagenNoticia values((Select top 1 idNoticia from Noticia order by idNoticia desc),@imagenes)
go



*******************FIN NOTICIAS*********************************************

**************Usuarios
Create or alter proc login
@usuario varchar(30),
@contrasena varchar(30)
as
Select p.idPersona,p.nombre,p.apellido1,p.apellido2,p.correo,u.idUsuario,u.idRol,r.nombre as rolNombre,u.usuario,u.contrasena From Usuario u JOIN Persona p on p.idPersona=u.idUsuario
JOIN Rol  r on u.idRol=r.idRol where u.usuario=@usuario and u.contrasena=@contrasena
go

--

Create or alter proc crearPersona
@nombre varchar(60),
@apellido1 varchar(60),
@apellido2 varchar(60),
@correo varchar(100)
as
Insert into Persona values(@nombre,@apellido1,@apellido2,@correo)
go

--

Create or alter proc crearUsuario
@idRol int,
@usuario varchar(30),
@contrasena varchar(30)
as
Insert into Usuario(idUsuario,idRol,usuario,contrasena) values((Select TOP 1 idPersona From Persona order by idPersona desc),@idRol,@usuario,@contrasena)
go  

**************Usuarios

************DetalleMaterias
CREATE OR ALTER proc listaMaterias
@idUsuario int
as
Select de.idDetalleMateria,m.nombre as Materia, concat(p.nombre,' ',p.apellido1,' ',p.apellido2) as nomProfesor,s.nombre as Seccion,grado 
   From Detallemateria de JOIN Materia m on de.idMateria=m.idMateria Join Persona p  on de.idUsuario=p.idPersona 
   JOIN Seccion s on de.idSeccion=de.idSeccion  JOIN EstudiantesMaterias es on es.idDetalleMateria=de.idDetalleMateria where es.idUsuario=@idUsuario
   go


***************FIN MATERIAS****************************